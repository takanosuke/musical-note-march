# 音楽の行進隊
初音ミク「マジカルミライ 2021」 プログラミング・コンテスト応募作品

## 概要
* TextAliveAppAPIを利用して楽曲に合わせた演出を行うWebアプリケーションです。TextAliveAppAPIに対応した楽曲全てに対応しています。
* フレーズと共に出現する音譜が、サビや間奏で音楽に合わせて行進、ダンスする演出を楽しめます。
* 音譜の手動生成機能によって、演出をただ眺めるだけではなく自分の手で演出を創り出すことができます。
* 偶然が生み出すランダムな演出によって、何度再生しても毎回異なる演出を楽しむことができます。

## 使用方法
### 利用準備
* (前提) Node.jsがインストールされていること
* 以下のコマンドでプロジェクトのクローンと必要なモジュールをインストールします。
<pre>
git clone https://github.com/takanosuke/magicalmirai2021-procon.git
cd magicalmirai2021-procon
npm install
</pre>

### 開発サーバ起動
* 以下のコマンドで開発用サーバが起動します。ローカル環境でテストする際に利用します。
<pre>
npm run dev
</pre>

### ビルド
* 以下のコマンドで<code>docs</code>ディレクトリ以下にビルド済みファイルが生成されます。
<pre>
npm run build
</pre>

### 操作方法
* 画面中央の再生ボタンを押すことで楽曲&演出の再生ができます。
* 画面下の ^ ボタンを押すことでコントロールメニューが開き、楽曲の変更や再生位置の変更等ができます。

## 演出
演出パターンは以下の5つのパートに分かれています。
* オープニング
* メロディパート
* サビ
* 間奏
* エンディング

### オープニング
* 曲のタイトルが画面中央に徐々に吸い込まれていき、吸い込まれた後にそこから1つ目のフレーズが生まれるような演出です。
* 曲のタイトルの色は毎回ランダムで、1つ目のフレーズの色と一致するようになっています。
※ 前奏がない楽曲の場合はこの演出がない or 短縮版の演出となります。

### メロディパート
* 楽曲に合わせてフレーズが出現します。出現位置はランダムですが位置の偏りや画面絡から見切れがないように対策を入れています。
* 楽曲の声量に合わせて歌詞のサイズが変化します。まるで文字が歌っているような楽曲と同期した演出を楽しめます。
* 1つのフレーズに対して1つの音譜が生まれ、この音譜達がサビや間奏で楽曲を盛り上げます。
* 出現位置、色、音譜のサイズ、音譜の種類がランダムなので、毎回異なる演出を楽しめます。

### サビパート
* フレーズから生まれた音譜達が楽曲に合わせて楽譜の上を元気に行進します。
* よく見ると音譜の種類によって足の速さが違います。
* メロディパートと同様に、声量に合わせて歌詞のサイズが変化し、1フレーズに対して1つの音譜が生まれます。
### 間奏パート
* フレーズから生まれた音譜達が楽曲に合わせて元気に踊ります。

### エンディング
* 生まれた音譜達が徐々に円陣となって中央に集まります。
* 集まった音譜達がオープニングで吸い込まれた曲のタイトルを引っ張ってきて一緒に飛び出してきます。
※ 前奏がない楽曲の場合はこの演出がない or 短縮版の演出となります。

## 機能
このアプリケーションには主に以下2つの機能があります。
* 音譜の手動生成機能
* 再生位置コントロール機能(TextAliveホスト未接続時)

### 音譜の手動生成機能
* 楽曲の再生中に画面をクリックすることで、任意の位置に手動で音符を生み出すことができます。
* 手動で追加した音譜達も他の音譜達と同様にサビや間奏、エンディングで動き出し、演出に加わります。
* 音譜は最大20個まで生成でき、それ以降は最初に追加した音譜から消えていきます。

### 再生位置コントロール機能
* 画面下の ^ ボタンを押すことでコントロールメニューが開きます。
* 楽曲の再生と停止、再生する楽曲の変更等の基本的な操作が可能です。
* シークバーでは再生位置の確認と、楽曲の再生位置を自由に変更することができます。

## その他工夫点
* 自分の好きな位置から再生できるようにシークバーを採用しました。再生パートの情報によってどこからサビや間奏が始まるかが分かりやすくなっています。
* 動画読み込み時に前奏、サビ、間奏、後奏などの楽曲の構成を把握することで、様々な構成の楽曲に対応できるようにしています。
* 演出中にランダムな要素がありますが、動画がシークされても問題なく動作できるように対応しています。
* 歌詞のサイズを声量と同期させたり、音譜の動きをビートと合わせて動かしたりすることで、音楽と同期した演出にしています。